#!/usr/bin/env node
var e=Object.create,o=Object.defineProperty,t=Object.getOwnPropertyDescriptor,r=Object.getOwnPropertyNames,a=Object.getPrototypeOf,n=Object.prototype.hasOwnProperty,i=(i,s,l)=>(l=null!=i?e(a(i)):{},((e,a,i,s)=>{if(a&&"object"==typeof a||"function"==typeof a)for(let l of r(a))n.call(e,l)||l===i||o(e,l,{get:()=>a[l],enumerable:!(s=t(a,l))||s.enumerable});return e})(!s&&i&&i.__esModule?l:o(l,"default",{value:i,enumerable:!0}),i)),s=i(require("yargs"),1),l=require("yargs/helpers"),c=require("fs"),d=i(require("https"),1),p=require("process"),u=`${i(require("os"),1).default.homedir()}/.cache/lightpanda-node`,h=process.env.LIGHTPANDA_EXECUTABLE_PATH,f=`${u}/lightpanda`,g={darwin:{x64:"x86_64-macos",arm64:"aarch64-macos"},linux:{x64:"x86_64-linux",arm64:"aarch64-linux"}},y=async()=>{const e=g?.[p.platform]?.[p.arch];(0,c.existsSync)(u)||(0,c.mkdirSync)(u,{recursive:!0});const o=(e,t,r)=>{const a=(0,c.createWriteStream)(f);d.default.get(e,e=>{if(e.headers.location&&(301===e.statusCode||302===e.statusCode||307===e.statusCode))return o(e.headers.location,t,r);e.pipe(a).on("finish",()=>{t()}).on("error",e=>{r(e)})})};if(e){h&&(console.info("$LIGHTPANDA_EXECUTABLE_PATH found, skipping binary download…"),(0,p.exit)(0));try{console.info("⏳ Downloading latest version of Lightpanda browser…"),await(async e=>new Promise((t,r)=>o(e,t,r)))(`https://github.com/lightpanda-io/browser/releases/download/nightly/lightpanda-${e}`),(0,c.chmodSync)(f,c.constants.S_IRWXU),console.info("✅ Done!"),(0,p.exit)(0)}catch(o){console.log("error",o),console.warn(`Lightpanda's failed to download the binary file "${e}".`),(0,p.exit)(1)}}else console.warn("Lightpanda package doesn't ship with prebuilt binaries for your platform yet. "),(0,p.exit)(1)};(0,s.default)((0,l.hideBin)(process.argv)).command("upgrade","Upgrade the browser to the latest nightly version",()=>{},e=>{y()}).command("$0","Default",()=>{},e=>{console.info("ℹ️ Please enter a command")}).option("verbose",{alias:"v",type:"boolean",description:"Run with verbose logging"}).parse();