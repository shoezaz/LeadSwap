#!/usr/bin/env node
import o from"yargs";import{hideBin as e}from"yargs/helpers";import{constants as a,chmodSync as r,createWriteStream as n,existsSync as s,mkdirSync as i}from"fs";import t from"https";import{arch as l,exit as p,platform as c}from"process";import d from"os";var h=`${d.homedir()}/.cache/lightpanda-node`,m=process.env.LIGHTPANDA_EXECUTABLE_PATH,g=`${h}/lightpanda`,f={darwin:{x64:"x86_64-macos",arm64:"aarch64-macos"},linux:{x64:"x86_64-linux",arm64:"aarch64-linux"}},u=async()=>{const o=f?.[c]?.[l];s(h)||i(h,{recursive:!0});const e=(o,a,r)=>{const s=n(g);t.get(o,o=>{if(o.headers.location&&(301===o.statusCode||302===o.statusCode||307===o.statusCode))return e(o.headers.location,a,r);o.pipe(s).on("finish",()=>{a()}).on("error",o=>{r(o)})})};if(o){m&&(console.info("$LIGHTPANDA_EXECUTABLE_PATH found, skipping binary download…"),p(0));try{console.info("⏳ Downloading latest version of Lightpanda browser…"),await(async o=>new Promise((a,r)=>e(o,a,r)))(`https://github.com/lightpanda-io/browser/releases/download/nightly/lightpanda-${o}`),r(g,a.S_IRWXU),console.info("✅ Done!"),p(0)}catch(e){console.log("error",e),console.warn(`Lightpanda's failed to download the binary file "${o}".`),p(1)}}else console.warn("Lightpanda package doesn't ship with prebuilt binaries for your platform yet. "),p(1)};o(e(process.argv)).command("upgrade","Upgrade the browser to the latest nightly version",()=>{},o=>{u()}).command("$0","Default",()=>{},o=>{console.info("ℹ️ Please enter a command")}).option("verbose",{alias:"v",type:"boolean",description:"Run with verbose logging"}).parse();