import{constants as o,chmodSync as a,createWriteStream as n,existsSync as e,mkdirSync as r}from"fs";import i from"https";import{arch as s,exit as t,platform as l}from"process";import c from"os";var d=`${c.homedir()}/.cache/lightpanda-node`,p=process.env.LIGHTPANDA_EXECUTABLE_PATH,h=`${d}/lightpanda`,f={darwin:{x64:"x86_64-macos",arm64:"aarch64-macos"},linux:{x64:"x86_64-linux",arm64:"aarch64-linux"}};(async()=>{const c=f?.[l]?.[s];e(d)||r(d,{recursive:!0});const m=(o,a,e)=>{const r=n(h);i.get(o,o=>{if(o.headers.location&&(301===o.statusCode||302===o.statusCode||307===o.statusCode))return m(o.headers.location,a,e);o.pipe(r).on("finish",()=>{a()}).on("error",o=>{e(o)})})};if(c){p&&(console.info("$LIGHTPANDA_EXECUTABLE_PATH found, skipping binary download…"),t(0));try{console.info("⏳ Downloading latest version of Lightpanda browser…"),await(async o=>new Promise((a,n)=>m(o,a,n)))(`https://github.com/lightpanda-io/browser/releases/download/nightly/lightpanda-${c}`),a(h,o.S_IRWXU),console.info("✅ Done!"),t(0)}catch(o){console.log("error",o),console.warn(`Lightpanda's failed to download the binary file "${c}".`),t(1)}}else console.warn("Lightpanda package doesn't ship with prebuilt binaries for your platform yet. "),t(1)})();