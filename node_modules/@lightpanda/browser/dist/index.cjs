var e,t=Object.create,r=Object.defineProperty,o=Object.getOwnPropertyDescriptor,n=Object.getOwnPropertyNames,i=Object.getPrototypeOf,a=Object.prototype.hasOwnProperty,s=(e,t,i,s)=>{if(t&&"object"==typeof t||"function"==typeof t)for(let l of n(t))a.call(e,l)||l===i||r(e,l,{get:()=>t[l],enumerable:!(s=o(t,l))||s.enumerable});return e},l={};((e,t)=>{for(var o in t)r(e,o,{get:t[o],enumerable:!0})})(l,{lightpanda:()=>w}),module.exports=(e=l,s(r({},"__esModule",{value:!0}),e));var u=require("child_process"),p=((e,o,n)=>(n=null!=e?t(i(e)):{},s(!o&&e&&e.__esModule?n:r(n,"default",{value:e,enumerable:!0}),e)))(require("os"),1),c=`${p.default.homedir()}/.cache/lightpanda-node`,f=process.env.LIGHTPANDA_EXECUTABLE_PATH,h=`${c}/lightpanda`,d=e=>{if(!e||"string"!=typeof e)throw new Error(`URL is required and must be a string ${e}`);try{new URL(e)}catch{throw new Error(`Invalid URL format ${e}`)}if(!e.startsWith("http://")&&!e.startsWith("https://"))throw new Error(`URL must use http or https protocol ${e}`)},g=()=>f??h,m={dump:!0},b=require("child_process"),v={host:"127.0.0.1",port:9222},w={fetch:(e,t=m)=>{const{dump:r,disableHostVerification:o,httpProxy:n}=t;return d(e),n&&d(n),new Promise((t,i)=>{try{const i=g(),a=[{flag:"--dump",condition:r},{flag:"--insecure_disable_tls_host_verification",condition:o},{flag:`--http_proxy ${n}`,condition:n}].map(e=>e.condition?e.flag:"").join(" "),s=(0,u.execSync)(`${i} fetch ${a} ${e}`);r&&t(s.toString()),t(s)}catch(e){i(e)}})},serve:(e=v)=>{const{host:t,port:r,timeout:o,disableHostVerification:n,httpProxy:i}=e;return r&&(e=>{if(!e||"number"!=typeof e)throw new Error(`Port is required and must be a number ${e}`);if(e<=0)throw new Error(`Port should be a positive number ${e}`)})(r),i&&d(i),new Promise((e,a)=>{const s=g(),l=[{flag:"--host",value:t},{flag:"--port",value:r},{flag:"--timeout",value:o},{flag:"--insecure_disable_tls_host_verification",value:n,flagOnly:!0},{flag:"--http_proxy",value:i}].flatMap(e=>e.value?[e.flag,e.flagOnly?"":e.value.toString()]:"").filter(e=>""!==e),u=(0,b.spawn)(s,["serve",...l]);u.on("spawn",async()=>{console.info("ðŸ¼ Running Lightpanda's CDP serverâ€¦",{pid:u.pid}),await new Promise(e=>setTimeout(e,250)),e(u)}),u.on("error",e=>a(e))})}};